<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>https://GraviMaze.com</title>
<meta name="description" content="GraviMaze playable 2D tilt demo. Use device tilt to roll the ball through handcrafted mazes. Works on mobile (gyro) and desktop (keyboard / mouse)." />
<meta name="theme-color" content="#071029">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Poppins:wght@600;800&display=swap" rel="stylesheet">
<link rel="icon" href="icon.png" type="image/png">
<style>
  :root{
    --bg:#071029;
    --card: rgba(255,255,255,0.035);
    --glass: rgba(255,255,255,0.04);
    --accent1:#7C6BFF;
    --accent2:#6EE7B7;
    --muted: #9fb2cf;
    --radius:12px;
  }
  html,body{
    height:100%;
    margin:0;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    color:#eaf2fe;
    background: radial-gradient(600px 300px at 10% 10%, rgba(124,107,255,0.06), transparent 8%), var(--bg);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }
  .wrap{max-width:1100px;margin:18px auto;padding:18px;display:grid;grid-template-columns:1fr 340px;gap:18px;}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:var(--radius);padding:14px;border:1px solid var(--glass);box-shadow:0 8px 30px rgba(2,6,23,0.6);}
  .panel{display:flex;flex-direction:column;gap:8px;}
  .right{display:flex;flex-direction:column;gap:12px;min-width:240px;}
  .section{padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.03);}
  pre.code{background:rgba(3,6,12,0.8);padding:10px;border-radius:8px;color:#dbeafe;overflow:auto;font-family:monospace;font-size:13px;}
  footer{margin-top:12px;color:var(--muted);font-size:13px;text-align:center;}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:10px;}
  .brand{display:flex;align-items:center;gap:12px;}
  .logo{width:56px;height:100px;border-radius:12px;background:linear-gradient(1deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:10;color:#041021;font-family:Poppins;}
  h1{font-size:18px;margin:0;}
  .muted{color:var(--muted);font-size:13px;margin-top:6px;}
  /* Canvas */
  #gameWrap{display:flex;flex-direction:column;gap:12px;}
  canvas{display:block;width:100%;height:auto;max-height:760px;border-radius:10px;background:linear-gradient(180deg,#07162a 0%, #0b2340 100%);box-shadow:0 12px 40px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03);}
  #gameCanvas {
    background: #111;  /* dark background */
    border-radius: 12px;
    display: block;
    margin: 10px auto;
  }
  .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
  .btn{background:linear-gradient(90deg,var(--accent2),var(--accent1));color:#041021;padding:10px 12px;border-radius:10px;border:none;font-weight:700;cursor:pointer;}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);}
  .small{font-size:13px;color:var(--muted);}
  label{font-size:13px;color:var(--muted);}
  input[type=range]{width:100%;}
  .level-info{display:flex;gap:12px;align-items:center;justify-content:space-between;}
  .stats{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
  .badge{background:rgba(255,255,255,0.04);padding:6px 10px;border-radius:8px;font-weight:700;color:#fff;}
  /* Responsive */
  @media (max-width:980px){
    .wrap{grid-template-columns:1fr;padding:12px;}
    canvas{height:56vh;}
  }
  #gameCanvas { width: 100%; height: auto; display: block; }
</style>
</head>
<body>
<div class="wrap">
  <div>
    <header>
      <div class="brand">
        <div class="logo">GM</div>
        <div>
          <h1>GraviMaze â€” Tilt Your World (Playable)</h1>
          <div class="muted">Use your phone tilt (or arrow keys / mouse) to roll the ball to the goal</div>
        </div>
      </div>
      <div class="stats">
        <div class="badge" id="levelBadge">Level 1</div>
        <div class="badge" id="timeBadge">00:00.0</div>
        <div class="badge" id="starsBadge">â˜† â˜† â˜†</div>
      </div>
    </header>

    <div id="gameWrap" class="card">
      <button id="startButton" class="btn">Start Game</button>
      <canvas id="gameCanvas"></canvas>

      <!-- Gyroscope Permission Button -->
      <button class="btn ghost" id="enableGyroBtn" style="
        position: absolute;
        top: 20px;
        right: 20px;
        padding: 10px 16px;
        border-radius: 12px;
        border: none;
        background: #333;
        color: #fff;
        font-size: 14px;
        cursor: pointer;
      ">
        Enable Gyro
      </button>

      <div class="controls">
        <div style="flex:1;min-width:220px">
          <div class="level-info">
            <div>
              <div class="small">Tilt Sensitivity</div>
              <input id="sensRange" type="range" min="0.4" max="2.2" step="0.05" value="1.0">
            </div>
            <div style="text-align:right">
              <button class="btn" id="restartBtn">Restart</button>
              <button class="btn ghost" id="nextBtn" title="Next unlocked level">Next</button>
            </div>
          </div>
        </div>

        <div style="display:flex;gap:8px;align-items:center">
          <button class="btn ghost" id="calibrateBtn">Calibrate Gyro</button>
          <button class="btn ghost" id="muteBtn">Mute</button>
        </div>
      </div>

      <div style="display:flex;gap:12px;align-items:center;justify-content:space-between">
        <div class="small">Controls: mobile tilt (gyro). Desktop: arrow keys or drag inside canvas.</div>
        <div class="small">Progress saved locally.</div>
      </div>
    </div>
  </div>

  <aside class="right">
    <div class="section card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div style="font-weight:800">Level Detail</div>
          <div class="small" id="levelTheme">Classic Toy â€” Easy curves</div>
        </div>
        <div style="text-align:right">
          <div class="small">Best:</div>
          <div id="bestTime" style="font-weight:800">--:--.-</div>
        </div>
      </div>
      <div style="height:8px"></div>
      <div style="display:flex;gap:8px">
        <div class="small"><strong>Unlocks:</strong> skins & trails</div>
      </div>
    </div>

    <div class="section card">
      <div style="font-weight:800;margin-bottom:6px">Mazes (10)</div>
      <div class="small" id="mazeList"></div>
    </div>

    <div class="section card">
      <div style="font-weight:800;margin-bottom:6px">Developer Notes</div>
      <pre class="code">Engine: Canvas 2D physics simulation
Controls: DeviceOrientation or keyboard/mouse fallback
Storage: localStorage for level unlocks and best times</pre>
    </div>

    <div class="section card">
      <div style="font-weight:800;margin-bottom:6px">Tips</div>
      <div class="small">
        â€¢ Calibrate gyro before play (tap "Calibrate Gyro")<br>
        â€¢ Gentle small tilts for precision; bigger tilts for speed<br>
        â€¢ Use restart to retry quickly for faster times
      </div>
    </div>
  </aside>

  <footer class="card">Â© GraviMaze â€” demo â€” local play only</footer>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// ðŸŸ¦ Responsive canvas sizing
function resizeCanvas() {
  const width = Math.min(window.innerWidth - 40, 900);
  const height = Math.max(300, window.innerHeight - 220);
  canvas.width = width;
  canvas.height = height;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();
window.addEventListener("resize", () => {
  resizeCanvas();
  startLevel(currentLevel);
});

// ðŸŸ¢ Game state
let ball = { x: 60, y: 60, vx: 0, vy: 0, r: 10 };
let goal = { x: 200, y: 200, r: 16 };
let tilt = { x: 0, y: 0 };
let gravity = 1.0;
let damping = 0.92;
let currentLevel = 0;
let levels = [];
let levelStartTime = 0;
let bestTimes = JSON.parse(localStorage.getItem("bestTimes") || "{}");

// ðŸ§© Maze builder
function createMaze(levelIndex) {
  const maze = [];
  const w = canvas.width, h = canvas.height;
  if (levelIndex === 0) {
    maze.push({ x: 50, y: h - 100, width: w - 100, height: 20 });
    maze.push({ x: w / 2 - 60, y: h / 2, width: 120, height: 10 });
  } else {
    for (let i = 0; i < 8 + levelIndex; i++) {
      maze.push({
        x: Math.random() * (w - 100),
        y: Math.random() * (h - 100),
        width: 60 + Math.random() * 100,
        height: 10 + Math.random() * 10
      });
    }
  }
  return maze;
}

// âš™ï¸ Setup level
function startLevel(index) {
  currentLevel = index;
  levels[index] = createMaze(index);
  ball.x = 60;
  ball.y = 60;
  ball.vx = 0;
  ball.vy = 0;
  goal.x = canvas.width - 60;
  goal.y = canvas.height - 60;
  levelStartTime = performance.now();

  document.getElementById("levelBadge").textContent = `Level ${index + 1}`;
  document.getElementById("timeBadge").textContent = "00:00.0";
  document.getElementById("levelTheme").textContent = `Maze ${index + 1}`;
}

// â±ï¸ Time display
function updateTime() {
  const elapsed = (performance.now() - levelStartTime) / 1000;
  document.getElementById("timeBadge").textContent = elapsed.toFixed(1) + "s";
}

// ðŸŽ® Physics update
function updatePhysics() {
  const maze = levels[currentLevel];
  if (!maze) return;

  ball.vx += tilt.x * gravity;
  ball.vy += tilt.y * gravity;
  ball.vx *= damping;
  ball.vy *= damping;
  // Limit max ball speed
  ball.vx = Math.max(Math.min(ball.vx, 8), -8);
  ball.vy = Math.max(Math.min(ball.vy, 8), -8);
  ball.x += ball.vx;
  ball.y += ball.vy;

  // Wall collisions
  maze.forEach(wall => {
    if (
      ball.x + ball.r > wall.x &&
      ball.x - ball.r < wall.x + wall.width &&
      ball.y + ball.r > wall.y &&
      ball.y - ball.r < wall.y + wall.height
    ) {
      const overlapX = Math.min(
        ball.x + ball.r - wall.x,
        wall.x + wall.width - (ball.x - ball.r)
      );
      const overlapY = Math.min(
        ball.y + ball.r - wall.y,
        wall.y + wall.height - (ball.y - ball.r)
      );
      if (overlapX < overlapY) {
        ball.vx *= -0.6;
        ball.x += ball.x < wall.x ? -overlapX : overlapX;
      } else {
        ball.vy *= -0.6;
        ball.y += ball.y < wall.y ? -overlapY : overlapY;
      }
    }
  });

  // Goal detection
  const dx = ball.x - goal.x, dy = ball.y - goal.y;
  const dist = Math.sqrt(dx * dx + dy * dy);
  if (dist < ball.r + goal.r) {
    const elapsed = (performance.now() - levelStartTime) / 1000;
    const best = bestTimes[currentLevel] || Infinity;
    if (elapsed < best) {
      bestTimes[currentLevel] = elapsed;
      localStorage.setItem("bestTimes", JSON.stringify(bestTimes));
      document.getElementById("bestTime").textContent = elapsed.toFixed(2) + "s";
      alert(`ðŸŽ‰ Level ${currentLevel + 1} completed in ${elapsed.toFixed(2)}s â€” new best!`);
    } else {
      alert(`âœ… Level ${currentLevel + 1} completed in ${elapsed.toFixed(2)}s`);
    }
    startLevel((currentLevel + 1) % 10);
  }
}

// ðŸŽ¨ Draw game
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  const maze = levels[currentLevel];
  if (!maze) return;

  // Maze
ctx.fillStyle = "rgba(255,255,255,0.25)";
ctx.strokeStyle = "rgba(255,255,255,0.5)";
ctx.lineWidth = 1.5;
maze.forEach(wall => {
  ctx.fillRect(wall.x, wall.y, wall.width, wall.height);
  ctx.strokeRect(wall.x, wall.y, wall.width, wall.height);
});

  // Goal
  const grd = ctx.createRadialGradient(goal.x, goal.y, 0, goal.x, goal.y, goal.r);
  grd.addColorStop(0, "#6EE7B7");
  grd.addColorStop(1, "transparent");
  ctx.fillStyle = grd;
  ctx.beginPath();
  ctx.arc(goal.x, goal.y, goal.r, 0, Math.PI * 2);
  ctx.fill();

  // Ball
  ctx.fillStyle = "#7C6BFF";
  ctx.beginPath();
  ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI * 2);
  ctx.fill();
}

// ðŸ” Game loop
function loop() {
  updateKeyboardTilt();
  updatePhysics();
  draw();
  updateTime();
  requestAnimationFrame(loop);
}

// ðŸ§­ Keyboard controls
const keyState = { ArrowLeft:false, ArrowRight:false, ArrowUp:false, ArrowDown:false };
document.addEventListener("keydown", e => { if (e.key in keyState) keyState[e.key] = true; });
document.addEventListener("keyup", e => { if (e.key in keyState) keyState[e.key] = false; });

function updateKeyboardTilt() {
  tilt.x = (keyState.ArrowRight ? 1 : 0) - (keyState.ArrowLeft ? 1 : 0);
  tilt.y = (keyState.ArrowDown ? 1 : 0) - (keyState.ArrowUp ? 1 : 0);
}

// ðŸ“± Gyroscope
function handleDeviceOrientation(e) {
  tilt.x = (e.gamma || 0) / 45;
  tilt.y = (e.beta || 0) / 45;
}

const enableGyroBtn = document.getElementById("enableGyroBtn");
enableGyroBtn.addEventListener("click", async () => {
  if (typeof DeviceOrientationEvent.requestPermission === "function") {
    const permission = await DeviceOrientationEvent.requestPermission();
    if (permission === "granted") {
      window.addEventListener("deviceorientation", handleDeviceOrientation);
      enableGyroBtn.style.display = "none";
    } else alert("Gyro permission denied.");
  } else {
    window.addEventListener("deviceorientation", handleDeviceOrientation);
    enableGyroBtn.style.display = "none";
  }
});

// â–¶ï¸ Start
document.getElementById("startButton").addEventListener("click", () => {
  startLevel(0);
  requestAnimationFrame(loop);
});

document.getElementById("restartBtn").addEventListener("click", () => startLevel(currentLevel));
document.getElementById("nextBtn").addEventListener("click", () => startLevel((currentLevel + 1) % 10));

startLevel(0);
draw();
</script>
</body>
</html>